<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
		<link rel="stylesheet" href="structure.css" />
        <title>Puissance 4</title>
    </head>

    <body>
		<h1 id="Titre">Puissance 4</h1>
	<script>
	    var i;
	    var buttonShift = 90; //starting left position in px

		for(i = 0; i < 7; i++){
			var btn = document.createElement("input");
			btn.type = "button";
			btn.className += "drop";
			btn.id = 'C' + i;
			btn.style.left = buttonShift + 'px';
		    btn.value = "Lacher jeton";
		    btn.onclick = (function(i) { return function() { Tour(i); }; })(i);
		    buttonShift += 60;
			document.body.appendChild(btn); //Adding node to the body
		}

	</script>

		<canvas id="canvas" width="500" height="400">
		<p>Désolé, votre navigateur ne supporte pas Canvas. Mettez-vous à jour</p>
		</canvas>
		<p id="AquiLeTourdeJouer">Les jaunes commencent !</p>
		<script>

		var canvas  = document.querySelector('#canvas');
		var context = canvas.getContext('2d');
		var taille_cellule = 60 ; // taille de la cellule de base
		var epaisseur_traits = taille_cellule / 6 ; //épaisseur des traits de construction
		var XorigGrille = 30 ; // abcisse origine grille de jeu
		var YorigGrille = 30 ; // ordonnée origine grille de jeu
		var TourDeJouer; // objet affichant à qui c'est le tour
		
		var colorWhite = "#FFFFFF"; //fond
		var colorYellow = "#FFFF00";
		var colorRed = "#FF0000";
		var CouleurQuiJoue = colorYellow; //ce sont les jaunes qui commencent par défaut

		// on dessine la grille de jeu
		context.strokeStyle = "RGB(0,0,255)"; // bleu 
				

		context.fillStyle = "RGB(0,0,255)";
		context.fillRect(0, 0, 600, 500);
		
		var coords = [];

		context.fillStyle = colorWhite;

		for (var ColonneGrille = 0 ; ColonneGrille <= 6 ; ColonneGrille++) {
			for (var LigneGrille = 0 ; LigneGrille <= 5 ; LigneGrille++) {
			
				context.beginPath(); //cercle bleu entourant le jeton

				var x = XorigGrille + taille_cellule / 2 + taille_cellule * ColonneGrille;
				var y = YorigGrille + taille_cellule / 2 + taille_cellule * LigneGrille;

				coords.push( [x, y, colorWhite] );
				context.arc(x, y, 30, 0, Math.PI*2);//Faire les calculs avant l'appel de la fonction.
				context.fill();						//Cela permet d'avoir une signature de fonction plus lisible.
			}	
		}
		
		function Tour(Colonne){
			/*
			0 = 60
			1 = 120
			2 = 180
			3 = 240
			4 = 300
			5 = 360
			6 = 420
			*/

			var cols = {};
			j = 60;
			for(var i = 0; i < 7; i++){
				cols[i] = j;
				j += 60;
			}

			var x = cols[Colonne];
			var found = false;
			var c = coords.length - 1;

			while(found == false){
				var item = coords[c];
				if(item[0] == x && item[2] == colorWhite){
					var y = item[1];
					Paint(x, y, CouleurQuiJoue);
					coords[c] = [x, y, CouleurQuiJoue];//updating coords
					found = true;
				}
				c--;
			}

			switch (CouleurQuiJoue) {
				case colorYellow:
					CouleurQuiJoue = colorRed;
					document.getElementById('AquiLeTourdeJouer').innerHTML = 'Les jaunes ont joué, ça va être aux rouges de jouer !!'
					document.getElementById('AquiLeTourdeJouer').style.color = "RGB(255,0,0)";
					break;
				case colorRed:
					CouleurQuiJoue = colorYellow;
					document.getElementById('AquiLeTourdeJouer').innerHTML = 'Les rouges ont joué, ça va être aux jaunes de jouer !!'; 
					document.getElementById('AquiLeTourdeJouer').style.color = "RGB(255,255,0)";
					break;
			
			}
		}
		
		//Function non utilise dans ma version du code actuelle
		function DesactiverCol(Colonne){
			var col = document.getElementById('C' + Colonne);

			col.stopPropagation(); //desactive la propagation de l'event onclick pour cet item.
			col.style.backgroundColor = "RGB(100,100,100)";
			col.style.color = "RGB(200,200,200)";
		}
		
		//L'avantage de cette fonction est que tu repeins une seule case, et non l'integralite du tableau de jeu.
		//Des gains de performances (pas forcement important dans ce cas pratique ci, mais certainement dans le futur vu l'ampleur des projets auquels tu t'attaques).
		function Paint(x, y, fillStyle){
			context.beginPath(); 
			context.fillStyle = fillStyle;
			context.arc(x, y, taille_cellule / 2 - epaisseur_traits / 2, 0, Math.PI * 2);
			context.fill();	
		}		
		</script>		
	</body>
</html>
